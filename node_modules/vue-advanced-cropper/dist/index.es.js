import Vue from"vue";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n,a=0;a<t.length;a++)n=t[a],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null==arguments[t]?{}:arguments[t],a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.forEach(function(t){_defineProperty(e,t,n[t])})}return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function createCommonjsModule(e,t){return t={exports:{}},e(t,t.exports),t.exports}var classnames=createCommonjsModule(function(e){/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/ /* global define */(function(){function t(){for(var e,n=[],a=0;a<arguments.length;a++)if(e=arguments[a],e){var o=typeof e;if("string"===o||"number"===o)n.push(e);else if(Array.isArray(e)&&e.length){var s=t.apply(null,e);s&&n.push(s)}else if("object"===o)for(var r in e)i.call(e,r)&&e[r]&&n.push(r)}return n.join(" ")}var i={}.hasOwnProperty;e.exports?(t.default=t,e.exports=t):window.classNames=t})()}),easyBem=function(e){return function(t,i){if(!t)return e;var n;"string"==typeof t?n=t:i=t;var a=e;return n&&(a+="__"+n),a+(i?Object.keys(i).reduce(function(e,t){var n=i[t];return n&&(e+=" "+("boolean"==typeof n?a+"--"+t:a+"--"+t+"_"+n)),e},""):"")}};/**
 * BEM class name factory.
 *
 * @typedef {Function} Bem
 * @param {String|Object} [elementOrMods] Element name or hash object with mods
 * @param {Object} [mods] Hash object with mods
 * @returns {String}
 */ /**
 * Returns BEM class name factory.
 *
 * @param {String} componentName Block name
 * @returns {Bem}
 */ /**
 * Returns a function, that, as long as it continues to be invoked, will not
 * be triggered. The function will be called after it stops being called for
 * N milliseconds. If `immediate` is passed, trigger the function on the
 * leading edge, instead of the trailing. The function also has a property 'clear' 
 * that is a function which will clear the timer to prevent previously scheduled executions. 
 *
 * @source underscore.js
 * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/
 * @param {Function} function to wrap
 * @param {Number} timeout in ms (`100`)
 * @param {Boolean} whether to execute at the beginning (`false`)
 * @api public
 */function debounce(e,t,i){function n(){var c=Date.now()-r;c<t&&0<=c?a=setTimeout(n,t-c):(a=null,!i&&(h=e.apply(s,o),s=o=null))}var a,o,s,r,h;null==t&&(t=100);var c=function(){s=this,o=arguments,r=Date.now();var c=i&&!a;return a||(a=setTimeout(n,t)),c&&(h=e.apply(s,o),s=o=null),h};return c.clear=function(){a&&(clearTimeout(a),a=null)},c.flush=function(){a&&(h=e.apply(s,o),s=o=null,clearTimeout(a),a=null)},c}debounce.debounce=debounce;var debounce_1=debounce;function directionNames(e,t){var i,n;return e&&t?(i="".concat(e).concat(t[0].toUpperCase()).concat(t.slice(1)),n="".concat(e,"-").concat(t)):(i=e||t,n=e||t),{name:i,classname:n}}function isLocal(e){return /^data:/.test(e)||/^blob:/.test(e)}function isCrossOriginURL(e){if(isLocal(e))return!1;var t=window.location,i=/(\w+:)?(?:\/\/)([\w.-]+)?(?::(\d+))?\/?/,n=i.exec(e)||[],a={protocol:n[1]||"",host:n[2]||"",port:n[3]||""},o=function(e){return{"http:":80,"https:":443}[e]},s=function(e){return e.port||o(e.protocol||t.protocol)};return(a.protocol||a.host||a.port)&&!!!(a.protocol&&a.protocol==t.protocol&&a.host&&a.host==t.host&&a.host&&s(a)==s(t))}function isUndefined(e){return"undefined"==typeof e}function addTimestamp(e){var t="timestamp=".concat(new Date().getTime());return e+(-1===e.indexOf("?")?"?":"&")+t}var ResizeEvent=function e(t,i,n){_classCallCheck(this,e),this.nativeEvent=t,this.directions=i,this.params=n},MoveEvent=function e(t,i){_classCallCheck(this,e),this.nativeEvent=t,this.directions=i},DragEvent=/*#__PURE__*/function(){function e(t,i,n,a,o){_classCallCheck(this,e),this.nativeEvent=t,this.position=n,this.previousPosition=a,this.element=i,this.anchor=o}return _createClass(e,[{key:"shift",value:function(){var e=this.element,t=this.anchor,i=this.position,n=e.getBoundingClientRect(),a=n.left,o=n.top;return{left:i.left-a-t.left,top:i.top-o-t.top}}}]),e}(),draggable={beforeMount:function(){window.addEventListener("mouseup",this.onMouseUp,{passive:!1}),window.addEventListener("mousemove",this.onMouseMove,{passive:!1}),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd,{passive:!1})},beforeDestroy:function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},mounted:function(){if(!this.$refs.draggable)throw new Error("You should add ref \"draggable\" to your root element to use draggable mixin");this.touches=[],this.draggingAnchor=[],this.hovered=!1},methods:{onMouseOver:function(){this.hovered||(this.hovered=!0,this.$emit("enter"))},onMouseLeave:function(){this.hovered&&(this.hovered=!1,this.$emit("leave"))},onTouchStart:function(t){t.cancelable&&(this.touches=_toConsumableArray(t.touches),!this.hovered&&this.$emit("enter"),t.touches.length&&this.initAnchor(this.touches.reduce(function(e,i){return{clientX:e.clientX+i.clientX/t.touches.length,clientY:e.clientY+i.clientY/t.touches.length}},{clientX:0,clientY:0})),t.preventDefault&&t.preventDefault(),t.stopPropagation())},onTouchEnd:function(){this.processEnd()},onTouchMove:function(t){this.touches.length&&(this.processMove(t,t.touches),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation())},onMouseDown:function(t){var e={fake:!0,clientX:t.clientX,clientY:t.clientY};this.touches=[e],this.initAnchor(e),t.stopPropagation()},onMouseMove:function(t){this.touches.length&&(this.processMove(t,[{fake:!0,clientX:t.clientX,clientY:t.clientY}]),t.preventDefault&&t.preventDefault())},onMouseUp:function(){this.touches=[]},initAnchor:function(e){var t=this.$refs.draggable,i=t.getBoundingClientRect(),n=i.left,a=i.right,o=i.bottom,s=i.top;this.anchor={left:e.clientX-n,top:e.clientY-s,bottom:o-e.clientY,right:a-e.clientX}},processMove:function(e,t){var i=_toConsumableArray(t);if(this.touches.length){if(1===this.touches.length&&1===i.length){var n=this.$refs.draggable;this.$emit("drag",new DragEvent(e,n,{left:i[0].clientX,top:i[0].clientY},{left:this.touches[0].clientX,top:this.touches[0].clientY},this.anchor))}this.touches=i}},processEnd:function(){this.touches=[],this.hovered&&(this.$emit("leave"),this.hovered=!1)}}},script={name:"DraggableElement",mixins:[draggable],props:{classname:{type:String}}};function normalizeComponent(e,t,i,n,a,o/* server only */,s,r,h,c){"boolean"!=typeof s&&(h=r,r=s,s=!1);// Vue.extend constructor export interop.
var l="function"==typeof i?i.options:i;// render functions
e&&e.render&&(l.render=e.render,l.staticRenderFns=e.staticRenderFns,l._compiled=!0,a&&(l.functional=!0)),n&&(l._scopeId=n);var d;if(o?(d=function(e){e=e||// cached call
this.$vnode&&this.$vnode.ssrContext||// stateful
this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,h(e)),e&&e._registeredComponents&&e._registeredComponents.add(o)},l._ssrRegister=d):t&&(d=s?function(){t.call(this,c(this.$root.$options.shadowRoot))}:function(e){t.call(this,r(e))}),d)if(l.functional){// register for functional component in vue file
var m=l.render;l.render=function(e,t){return d.call(t),m(e,t)}}else{// inject component registration as beforeCreate hook
var p=l.beforeCreate;l.beforeCreate=p?[].concat(p,d):[d]}return i}var normalizeComponent_1=normalizeComponent,__vue_script__=script,__vue_render__=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"draggable",class:e.classname,on:{touchstart:e.onTouchStart,mousedown:e.onMouseDown,mouseover:e.onMouseOver,mouseleave:e.onMouseLeave}},[e._t("default")],2)},__vue_staticRenderFns__=[];/* script */__vue_render__._withStripped=!0;/* style */var __vue_inject_styles__=void 0,__vue_scope_id__=void 0,__vue_module_identifier__=void 0,__vue_is_functional_template__=!1,DraggableElement=normalizeComponent_1({render:__vue_render__,staticRenderFns:__vue_staticRenderFns__},void 0,__vue_script__,__vue_scope_id__,__vue_is_functional_template__,__vue_module_identifier__,void 0,void 0),cn=easyBem("vue-handler-wrapper"),script$1={name:"HandlerWrapper",components:{DraggableElement:DraggableElement},props:{horizontalPosition:{type:String},verticalPosition:{type:String},classname:{type:String}},computed:{classnames:function(){var e;if(this.horizontalPosition||this.verticalPosition){var t=directionNames(this.horizontalPosition,this.verticalPosition);e=classnames(this.classname,cn(_defineProperty({},t.classname,!0)))}else e=classnames(this.classname,cn());return{default:e,draggable:cn("draggable")}}}},__vue_script__$1=script$1,__vue_render__$1=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.classnames.default},[i("DraggableElement",{class:e.classnames.draggable,on:{drag:function(t){return e.$emit("drag",t)},leave:function(){return e.$emit("leave")},enter:function(){return e.$emit("enter")}}},[e._t("default")],2)],1)},__vue_staticRenderFns__$1=[];/* scoped */__vue_render__$1._withStripped=!0;/* style */var __vue_inject_styles__$1=void 0,__vue_scope_id__$1=void 0,__vue_module_identifier__$1=void 0,__vue_is_functional_template__$1=!1,HandlerWrapper=normalizeComponent_1({render:__vue_render__$1,staticRenderFns:__vue_staticRenderFns__$1},void 0,__vue_script__$1,__vue_scope_id__$1,__vue_is_functional_template__$1,__vue_module_identifier__$1,void 0,void 0),cn$1=easyBem("vue-line-wrapper"),script$2={name:"LineWrapper",components:{DraggableElement:DraggableElement},props:{position:{type:String,required:!0}},computed:{classname:function(){return cn$1(_defineProperty({},this.position,!0))}}},__vue_script__$2=script$2,__vue_render__$2=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("DraggableElement",{class:e.classname,on:{drag:function(t){return e.$emit("drag",t)},leave:function(){return e.$emit("leave")},enter:function(){return e.$emit("enter")}}},[e._t("default")],2)},__vue_staticRenderFns__$2=[];/* scoped */__vue_render__$2._withStripped=!0;/* style */var __vue_inject_styles__$2=void 0,__vue_scope_id__$2=void 0,__vue_module_identifier__$2=void 0,__vue_is_functional_template__$2=!1,LineWrapper=normalizeComponent_1({render:__vue_render__$2,staticRenderFns:__vue_staticRenderFns__$2},void 0,__vue_script__$2,__vue_scope_id__$2,__vue_is_functional_template__$2,__vue_module_identifier__$2,void 0,void 0),cn$2=easyBem("vue-bounding-box"),HORIZONTAL_DIRECTIONS=["east","west",null],VERTICAL_DIRECTIONS=["south","north",null],script$3={name:"BoundingBox",props:{classname:{type:String},handlers:{type:Object,default:function(){return{eastNorth:!0,north:!0,westNorth:!0,west:!0,westSouth:!0,south:!0,eastSouth:!0,east:!0}}},handlerComponent:{type:[Object,String]},handlersClassnames:{type:Object,default:function(){return{}}},lines:{type:Object,default:function(){return{west:!0,north:!0,east:!0,south:!0}}},lineComponent:{type:[Object,String]},linesClassnames:{type:Object,default:function(){return{}}}},data:function(){var e=[];return HORIZONTAL_DIRECTIONS.forEach(function(t){VERTICAL_DIRECTIONS.forEach(function(i){if(t!==i){var n=directionNames(t,i),a=n.name,o=n.classname;e.push({name:a,classname:o,verticalDirection:i,horizontalDirection:t})}})}),{points:e}},computed:{classnames:function(){var e=this.handlersClassnames,t=this.linesClassnames;return{default:classnames(cn$2(),this.classname),handlers:e,lines:t}},lineNodes:function(){var e=this,t=[];return this.points.forEach(function(i){i.horizontalDirection&&i.verticalDirection||!e.lines[i.name]||t.push({name:i.name,component:e.lineComponent,classname:classnames(e.classnames.lines.default,e.classnames.lines[i.name]),hoverClassname:e.classnames.lines.hover,verticalDirection:i.verticalDirection,horizontalDirection:i.horizontalDirection})}),t},handlerNodes:function(){var e=this,t=[];return this.points.forEach(function(i){e.handlers[i.name]&&t.push({name:i.name,component:e.handlerComponent,classname:classnames(e.classnames.handlers.default,e.classnames.handlers[i.name]),hoverClassname:e.classnames.handlers.hover,verticalDirection:i.verticalDirection,horizontalDirection:i.horizontalDirection})}),t}},beforeMount:function(){window.addEventListener("mouseup",this.onMouseUp,{passive:!1}),window.addEventListener("mousemove",this.onMouseMove,{passive:!1}),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd,{passive:!1})},beforeDestroy:function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},mounted:function(){this.touches=[],this.draggingAnchor=[]},methods:{onHandlerDrag:function(e,t,i){var n=e.shift(),a=n.left,o=n.top,s={left:0,right:0,top:0,bottom:0};"west"===t?s.left-=a:"east"==t&&(s.right+=a),"north"===i?s.top-=o:"south"==i&&(s.bottom+=o);var r;!i&&t?r="width":i&&!t&&(r="height"),this.$emit("resize",new ResizeEvent(e.nativeEvent,s,{allowedDirections:{left:"west"===t||!t,right:"east"===t||!t,bottom:"south"===i||!i,top:"north"===i||!i},preserveAspectRatio:e.nativeEvent.shiftKey,respectDirection:r}))}}},__vue_script__$3=script$3,__vue_render__$3=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"box",class:e.classnames.default},[e._t("default"),e._v(" "),i("div",e._l(e.lineNodes,function(t){return i(t.component,{key:t.name,tag:"component",attrs:{classname:t.classname,"hover-classname":t.hoverClassname,position:t.name},on:{drag:function(i){return e.onHandlerDrag(i,t.horizontalDirection,t.verticalDirection)}}})}),1),e._v(" "),i("div",e._l(e.handlerNodes,function(t){return i(t.component,{key:t.name,tag:"component",attrs:{classname:t.classname,"hover-classname":t.hoverClassname,"horizontal-position":t.horizontalDirection,"vertical-position":t.verticalDirection},on:{drag:function(i){return e.onHandlerDrag(i,t.horizontalDirection,t.verticalDirection)}}})}),1)],2)},__vue_staticRenderFns__$3=[];/* scoped */__vue_render__$3._withStripped=!0;/* style */var __vue_inject_styles__$3=void 0,__vue_scope_id__$3=void 0,__vue_module_identifier__$3=void 0,__vue_is_functional_template__$3=!1,BoundingBox=normalizeComponent_1({render:__vue_render__$3,staticRenderFns:__vue_staticRenderFns__$3},void 0,__vue_script__$3,__vue_scope_id__$3,__vue_is_functional_template__$3,__vue_module_identifier__$3,void 0,void 0),cn$3=easyBem("vue-draggable-area"),script$4={name:"DraggableArea",computed:{classnames:function(){return{default:classnames(cn$3(),this.classname)}}},beforeMount:function(){window.addEventListener("mouseup",this.onMouseUp,{passive:!1}),window.addEventListener("mousemove",this.onMouseMove,{passive:!1}),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd,{passive:!1})},beforeDestroy:function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},mounted:function(){this.touches=[],this.draggingAnchor=[]},methods:{onTouchStart:function(t){t.cancelable&&(this.touches=_toConsumableArray(t.touches),t.touches.length&&this.initAnchor(this.touches.reduce(function(e,i){return{clientX:e.clientX+i.clientX/t.touches.length,clientY:e.clientY+i.clientY/t.touches.length}},{clientX:0,clientY:0})),t.preventDefault&&t.preventDefault(),t.stopPropagation())},onTouchEnd:function(){this.processEnd()},onTouchMove:function(t){this.touches.length&&(this.processMove(t,t.touches),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation())},onMouseDown:function(t){var e={fake:!0,clientX:t.clientX,clientY:t.clientY};this.touches=[e],this.initAnchor(e),t.stopPropagation()},onMouseMove:function(t){this.touches.length&&(this.processMove(t,[{fake:!0,clientX:t.clientX,clientY:t.clientY}]),t.preventDefault&&t.cancelable&&t.preventDefault())},onMouseUp:function(){this.touches=[]},initAnchor:function(e){var t=this.$refs.container,i=t.getBoundingClientRect(),n=i.left,a=i.top;this.anchor={x:e.clientX-n,y:e.clientY-a}},processMove:function(e,t){var i=Math.pow,n=this,a=_toConsumableArray(t);if(this.touches.length){var o=this.$refs.container,s=o.getBoundingClientRect(),r=s.left,h=s.top;if(1===this.touches.length&&1===a.length)this.$emit("move",new MoveEvent(e,{left:a[0].clientX-r-this.anchor.x,top:a[0].clientY-h-this.anchor.y}));else if(1<this.touches.length&&this.touches.length===a.length){var c=a.map(function(e,t){return{x:e.clientX-n.touches[t].clientX,y:e.clientY-n.touches[t].clientY,position:{clientX:e.clientX,clientY:e.clientY},length:Math.sqrt(i(e.clientX-n.touches[t].clientX,2)+i(e.clientY-n.touches[t].clientY,2))}}),l=c.reduce(function(e,t){return e+t.length},0),d={left:c.reduce(function(e,t,i){return e+(1-t.length/l)*a[i].clientX},0),top:c.reduce(function(e,t,i){return e+(1-t.length/l)*a[i].clientY},0)},m={top:0,bottom:0,left:0,right:0};c.forEach(function(e,t){.25<e.length/l&&(a[t].clientY>d.top?m.bottom+=e.y:m.top-=e.y,a[t].clientX>d.left?m.right+=e.x:m.left-=e.x)}),this.$emit("resize",new ResizeEvent(e,m))}this.touches=a}},processEnd:function(){this.touches=[]}}},__vue_script__$4=script$4,__vue_render__$4=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"container",on:{touchstart:e.onTouchStart,mousedown:e.onMouseDown}},[e._t("default")],2)},__vue_staticRenderFns__$4=[];/* scoped */__vue_render__$4._withStripped=!0;/* style */var __vue_inject_styles__$4=void 0,__vue_scope_id__$4=void 0,__vue_module_identifier__$4=void 0,__vue_is_functional_template__$4=!1,DraggableArea=normalizeComponent_1({render:__vue_render__$4,staticRenderFns:__vue_staticRenderFns__$4},void 0,__vue_script__$4,__vue_scope_id__$4,__vue_is_functional_template__$4,__vue_module_identifier__$4,void 0,void 0),HORIZONTAL_DIRECTIONS$1=["left","right"],VERTICAL_DIRECTIONS$1=["top","bottom"],ALL_DIRECTIONS=["left","right","top","bottom"],XHR_DONE=4;/* scoped */function prepareSource(e,t,i){var n=Math.PI,a=i.flipped,o=i.orientation,s=t.naturalWidth,r=t.naturalHeight,h=e.getContext("2d");return e.width=s,e.height=r,h.save(),a&&(e.width=r,e.height=s),2==o?(h.translate(s,0),h.scale(-1,1)):3==o?(h.translate(s,r),h.rotate(1*n)):4==o?(h.translate(0,r),h.scale(1,-1)):5==o?(h.rotate(90/180*n),h.scale(1,-1)):6==o?(h.rotate(90/180*n),h.translate(0,-r)):7==o?(h.rotate(270/180*n),h.translate(-s,r),h.scale(1,-1)):8==o&&(h.translate(0,s),h.rotate(270/180*n)),h.drawImage(t,0,0,s,r),h.restore(),e}function getImageTransforms(e){var t={orientation:e};return e&&(2===e?t.scaleX=-1:3===e?t.rotate=-180:4===e?t.scaleY=-1:5===e?(t.rotate=90,t.scaleY=-1):6===e?t.rotate=90:7===e?(t.rotate=90,t.scaleX=-1):8===e?t.rotate=-90:void 0),(90===t.rotate||-90===t.rotate)&&(t.flipped=!0),t}function getStyleTransforms(e){var t=e.rotate,i=e.scaleX,n=e.scaleY,a="";return(t||i||n)&&(t&&(a+=" rotate(".concat(t,"deg) ")),i&&(a+=" scaleX(".concat(i,") ")),n&&(a+=" scaleY(".concat(n,") "))),a}function parseImage(e){return new Promise(function(t){getImageData(e).then(function(e){t(e?{arrayBuffer:e,orientation:getOrientation(e)}:{arrayBuffer:null,orientation:null})}).catch(function(e){console.warn(e),t({arrayBuffer:null,orientation:null})})})}function getImageData(e){return new Promise(function(t,i){try{if(!e)i("Error: the image is empty");else// Data URL
if(/^data:/i.test(e))t(base64ToArrayBuffer(e));else if(/^blob:/i.test(e)){var n=new FileReader;n.onload=function(i){t(i.target.result)},objectURLToBlob(e,function(e){n.readAsArrayBuffer(e)})}else{var a=new XMLHttpRequest;a.onreadystatechange=function(){this.readyState!==XHR_DONE||(200===this.status||0===this.status?t(this.response):i("Warning: could not load an image to parse its orientation"),a=null)},a.onprogress=function(){"image/jpeg"!==a.getResponseHeader("content-type")&&a.abort()},a.withCredentials=!1,a.open("GET",e,!0),a.responseType="arraybuffer",a.send(null)}}catch(t){i(t)}})}function objectURLToBlob(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(){(200==this.status||0===this.status)&&t(this.response)},i.send()}function base64ToArrayBuffer(e){e=e.replace(/^data:([^;]+);base64,/gmi,"");for(var t=atob(e),n=t.length,a=new ArrayBuffer(n),o=new Uint8Array(a),s=0;s<n;s++)o[s]=t.charCodeAt(s);return a}function getStringFromCharCode(e,t,n){var a,o="";for(a=t,n+=t;a<n;a++)o+=String.fromCharCode(e.getUint8(a));return o}function getOrientation(e){try{var t,n,a,o,s,r,h=new DataView(e);// Only handle JPEG image (start by 0xFFD8)
if(255===h.getUint8(0)&&216===h.getUint8(1))for(var c=h.byteLength,l=2;l+1<c;){if(255===h.getUint8(l)&&225===h.getUint8(l+1)){s=l;break}l++}if(s&&(n=s+4,a=s+10,"Exif"===getStringFromCharCode(h,n,4))){var d=h.getUint16(a);if(o=18761===d,(o||19789===d)&&42===h.getUint16(a+2,o)/* bigEndian */){var m=h.getUint32(a+4,o);8<=m&&(r=a+m)}}if(r)for(var p,g=h.getUint16(r,o),u=0;u<g;u++)if(p=r+12*u+2,274===h.getUint16(p,o)/* Orientation */){p+=8,t=h.getUint16(p,o),h.setUint16(p,1,o);break}return t}catch(e){return null}}function arrayBufferToDataURL(e){for(var t=[],i=8192,n=new Uint8Array(e)// Chunk Typed Array for better performance (#435)
;0<n.length;){var a=n.subarray(0,i);t.push(String.fromCharCode.apply(null,Array.from?Array.from(a):Array.slice(a))),n=n.subarray(i)}return"data:image/jpeg;base64,".concat(btoa(t.join("")))}var cn$4=easyBem("vue-preview-result"),script$5={name:"PreviewResult",props:{img:{type:Object},classname:{type:String},imageClassname:{type:String},resultCoordinates:{type:Object,default:function(){return{width:0,height:0,left:0,top:0}}},stencilCoordinates:{type:Object,default:function(){return{width:0,height:0,left:0,top:0}}}},computed:{classnames:function(){return{default:classnames(cn$4(),this.classname),image:classnames(cn$4("image"),this.imageClassname),wrapper:cn$4("wrapper")}},wrapperStyle:function(){return{width:"".concat(this.stencilCoordinates.width,"px"),height:"".concat(this.stencilCoordinates.height,"px"),left:"calc(50% - ".concat(this.stencilCoordinates.width/2,"px)"),top:"calc(50% - ".concat(this.stencilCoordinates.height/2,"px)")}},imageStyle:function(){var e=this.img.transforms,t=this.img.size.width,i=this.img.size.height,n=this.stencilCoordinates.height/this.resultCoordinates.height,a=i*n,o=t*n,s=e.flipped,r={width:"".concat(o,"px"),height:"".concat(a,"px")};return s?(r.width="".concat(a,"px"),r.height="".concat(o,"px"),r.left="".concat(-this.stencilCoordinates.left-(a-o)/2,"px"),r.top="".concat(-this.stencilCoordinates.top-(o-a)/2,"px")):(r.width="".concat(o,"px"),r.height="".concat(a,"px"),r.left="".concat(-this.stencilCoordinates.left,"px"),r.top="".concat(-this.stencilCoordinates.top,"px")),r.transform=getStyleTransforms(e),r}}},__vue_script__$5=script$5,__vue_render__$5=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.classnames.default},[i("div",{ref:"wrapper",class:e.classnames.wrapper,style:e.wrapperStyle},[i("img",{ref:"image",class:e.classnames.image,style:e.imageStyle,attrs:{src:e.img.src}})])])},__vue_staticRenderFns__$5=[];__vue_render__$5._withStripped=!0;/* style */var __vue_inject_styles__$5=void 0,__vue_scope_id__$5=void 0,__vue_module_identifier__$5=void 0,__vue_is_functional_template__$5=!1,PreviewResult=normalizeComponent_1({render:__vue_render__$5,staticRenderFns:__vue_staticRenderFns__$5},void 0,__vue_script__$5,__vue_scope_id__$5,__vue_is_functional_template__$5,__vue_module_identifier__$5,void 0,void 0),cn$5=easyBem("vue-square-handler"),script$6={name:"SimpleHandler",components:{HandlerWrapper:HandlerWrapper},props:{classname:{type:String},hoverClassname:{type:String},horizontalPosition:{type:String},verticalPosition:{type:String}},computed:{classnames:function(){return{default:classnames(cn$5(_defineProperty({},this.position,!0)),this.classname,this.hover&&this.hoverClassname)}}},methods:{onDrag:function(e){this.$emit("drag",e)},onEnter:function(){this.hover=!0},onLeave:function(){this.hover=!1}}},__vue_script__$6=script$6,__vue_render__$6=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("HandlerWrapper",{attrs:{"vertical-position":e.verticalPosition,"horizontal-position":e.horizontalPosition},on:{drag:e.onDrag}},[i("div",{class:e.classnames.default})])},__vue_staticRenderFns__$6=[];/* scoped */__vue_render__$6._withStripped=!0;/* style */var __vue_inject_styles__$6=void 0,__vue_scope_id__$6=void 0,__vue_module_identifier__$6=void 0,__vue_is_functional_template__$6=!1,SimpleHandler=normalizeComponent_1({render:__vue_render__$6,staticRenderFns:__vue_staticRenderFns__$6},void 0,__vue_script__$6,__vue_scope_id__$6,__vue_is_functional_template__$6,__vue_module_identifier__$6,void 0,void 0),cn$6=easyBem("vue-simple-line"),script$7={name:"SimpleLine",components:{LineWrapper:LineWrapper},props:{classname:{type:String},hoverClassname:{type:String},position:{type:String}},data:function(){return{hover:!1}},computed:{classnames:function(){return{default:classnames(cn$6(_defineProperty({},this.position,!0)),this.classname,this.hover&&this.hoverClassname)}}},methods:{onDrag:function(e){this.$emit("drag",e)},onEnter:function(){this.hover=!0},onLeave:function(){this.hover=!1}}},__vue_script__$7=script$7,__vue_render__$7=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("LineWrapper",{attrs:{position:e.position},on:{enter:e.onEnter,leave:e.onLeave,drag:e.onDrag}},[i("div",{class:e.classnames.default})])},__vue_staticRenderFns__$7=[];/* scoped */__vue_render__$7._withStripped=!0;/* style */var __vue_inject_styles__$7=void 0,__vue_scope_id__$7=void 0,__vue_module_identifier__$7=void 0,__vue_is_functional_template__$7=!1,SimpleLine=normalizeComponent_1({render:__vue_render__$7,staticRenderFns:__vue_staticRenderFns__$7},void 0,__vue_script__$7,__vue_scope_id__$7,__vue_is_functional_template__$7,__vue_module_identifier__$7,void 0,void 0),cn$7=easyBem("vue-rectangle-stencil"),script$8={name:"RectangleStencil",components:{PreviewResult:PreviewResult,BoundingBox:BoundingBox,DraggableArea:DraggableArea},props:{img:{type:Object},resultCoordinates:{type:Object},stencilCoordinates:{type:Object},handlers:{type:Object},handlerComponent:{type:[Object,String],default:function(){return SimpleHandler}},handlersClassnames:{type:Object,default:function(){return{}}},lines:{type:Object},lineComponent:{type:[Object,String],default:function(){return SimpleLine}},linesClassnames:{type:Object,default:function(){return{}}},classname:{type:String},previewClassname:{type:String},boundingBoxClassname:{type:String},aspectRatio:{type:[Number,String]},minAspectRatio:{type:[Number,String]},maxAspectRatio:{type:[Number,String]}},computed:{classes:function(){return{stencil:classnames(cn$7(),this.classname),preview:classnames(cn$7("preview"),this.previewClassname),boundingBox:classnames(cn$7("bounding-box"),this.boundingBoxClassname)}},style:function(){var e=this.stencilCoordinates,t=e.height,i=e.width,n=e.left,a=e.top;return{width:"".concat(i,"px"),height:"".concat(t,"px"),left:"".concat(n,"px"),top:"".concat(a,"px")}}},methods:{onMove:function(e){this.$emit("move",e)},onResize:function(e){this.$emit("resize",e)},aspectRatios:function(){return{minimum:this.aspectRatio||this.minAspectRatio,maximum:this.aspectRatio||this.maxAspectRatio}}}},__vue_script__$8=script$8,__vue_render__$8=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.classes.stencil,style:e.style},[i("BoundingBox",{attrs:{classname:e.classes.boundingBox,handlers:e.handlers,"handler-component":e.handlerComponent,"handlers-classnames":e.handlersClassnames,lines:e.lines,"line-component":e.lineComponent,"lines-classnames":e.linesClassnames},on:{resize:e.onResize}},[i("DraggableArea",{on:{move:e.onMove}},[i("PreviewResult",{attrs:{img:e.img,classname:e.classes.preview,"result-coordinates":e.resultCoordinates,"stencil-coordinates":e.stencilCoordinates}})],1)],1)],1)},__vue_staticRenderFns__$8=[];/* scoped */__vue_render__$8._withStripped=!0;/* style */var __vue_inject_styles__$8=void 0,__vue_scope_id__$8=void 0,__vue_module_identifier__$8=void 0,__vue_is_functional_template__$8=!1,RectangleStencil=normalizeComponent_1({render:__vue_render__$8,staticRenderFns:__vue_staticRenderFns__$8},void 0,__vue_script__$8,__vue_scope_id__$8,__vue_is_functional_template__$8,__vue_module_identifier__$8,void 0,void 0),cn$8=easyBem("vue-circle-stencil"),script$9={name:"CircleStencil",components:{PreviewResult:PreviewResult,BoundingBox:BoundingBox,DraggableArea:DraggableArea},props:{img:{type:Object},stencilClass:{type:String},resultCoordinates:{type:Object},stencilCoordinates:{type:Object},handlers:{type:Object,default:function(){return{eastNorth:!0,westNorth:!0,westSouth:!0,eastSouth:!0}}},handlerComponent:{type:[Object,String],default:function(){return SimpleHandler}},handlersClassnames:{type:Object,default:function(){return{}}},lines:{type:Object},lineComponent:{type:[Object,String],default:function(){return SimpleLine}},linesClassnames:{type:Object,default:function(){return{}}},classname:{type:String},previewClassname:{type:String},boundingBoxClassname:{type:String}},computed:{classes:function(){return{stencil:classnames(cn$8(),this.classname),preview:classnames(cn$8("preview"),this.previewClassname),boundingBox:classnames(cn$8("bounding-box"),this.boundingBox)}},style:function(){var e=this.stencilCoordinates,t=e.height,i=e.width,n=e.left,a=e.top;return{width:"".concat(i,"px"),height:"".concat(t,"px"),left:"".concat(n,"px"),top:"".concat(a,"px")}}},methods:{onMove:function(e){this.$emit("move",e)},onResize:function(e){this.$emit("resize",e)},aspectRatios:function(){return{minimum:1,maximum:1}}}},__vue_script__$9=script$9,__vue_render__$9=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.classes.stencil,style:e.style},[i("BoundingBox",{attrs:{classname:e.classes.boundingBox,handlers:e.handlers,"handler-component":e.handlerComponent,"handlers-classnames":e.handlersClassnames,lines:e.lines,"line-component":e.lineComponent,"lines-classnames":e.linesClassnames},on:{resize:e.onResize}},[i("DraggableArea",{on:{move:e.onMove}},[i("PreviewResult",{attrs:{img:e.img,classname:e.classes.preview,"result-coordinates":e.resultCoordinates,"stencil-coordinates":e.stencilCoordinates}})],1)],1)],1)},__vue_staticRenderFns__$9=[];/* scoped */__vue_render__$9._withStripped=!0;/* style */var __vue_inject_styles__$9=void 0,__vue_scope_id__$9=void 0,__vue_module_identifier__$9=void 0,__vue_is_functional_template__$9=!1,CircleStencil=normalizeComponent_1({render:__vue_render__$9,staticRenderFns:__vue_staticRenderFns__$9},void 0,__vue_script__$9,__vue_scope_id__$9,__vue_is_functional_template__$9,__vue_module_identifier__$9,void 0,void 0);/* scoped */function getCurrentWidth(e,t,i){return e.width+i*(t.left+t.right)}function getCurrentHeight(e,t,i){return e.height+i*(t.top+t.bottom)}function fitConditions(e,t,i,n,a,o){var s=Math.min,r=Math.abs,h=Math.floor,c=Math.ceil,l=Math.pow,d=i.minHeight,m=i.minWidth,p=i.maxHeight,g=i.maxWidth,u=_objectSpread({},e),f=getCurrentWidth(t,u,n),v=getCurrentHeight(t,u,n);0>f&&(0>u.left&&0>u.right?(u.left=-(t.width-m)/(u.left/u.right),u.right=-(t.width-m)/(u.right/u.left)):0>u.left?u.left=-(t.width-m)/n:0>u.right&&(u.right=-(t.width-m)/n)),0>v&&(0>u.top&&0>u.bottom?(u.top=-(t.height-d)/(u.top/u.bottom),u.bottom=-(t.height-d)/(u.bottom/u.top)):0>u.top?u.top=-(t.height-d):0>u.bottom&&(u.bottom=-(t.height-d)));var w={width:1/0,height:1/0};// If ratio is not broken, resize all directions independently
if(u.right+u.left&&(c(t.left+t.width+n*u.right)>a.width&&(w.width=s(w.width,r(h(a.width-(t.left+t.width))/(n*u.right)))),0>t.left-n*u.left&&(w.width=s(w.width,r(t.left/(n*u.left)))),f<m&&(w.width=s(w.width,r((t.width-m)/((u.right+u.left)*n)))),f>g&&(w.width=s(w.width,r((g-t.width)/((u.right+u.left)*n))))),u.top+u.bottom&&(c(t.top+t.height+n*u.bottom)>a.height&&(w.height=s(w.height,r(h(a.height-(t.top+t.height))/(n*u.bottom)))),0>t.top-n*u.top&&(w.height=s(w.height,r(t.top/(n*u.top)))),v<d&&(w.height=s(w.height,r((t.height-d)/((u.top+u.bottom)*n)))),v>p&&(w.height=s(w.height,r((p-t.height)/((u.top+u.bottom)*n))))),w.width<l(10,-1)&&(w.width=0),w.height<l(10,-1)&&(w.height=0),!o)w.width!==1/0&&HORIZONTAL_DIRECTIONS$1.forEach(function(e){u[e]*=w.width}),w.height!==1/0&&VERTICAL_DIRECTIONS$1.forEach(function(e){u[e]*=w.height});else{var y;w.height<w.width?y=w.height:u.right+u.left&&(y=w.width),(w.height!==1/0||w.width!==1/0)&&ALL_DIRECTIONS.forEach(function(e){u[e]*=y})}return u}function resize(e){var t=Math.max,i=Math.round,n=e.coordinates,a=e.restrictions,o=e.imageSize,s=e.coefficient,r=e.aspectRatio,h=e.resizeEvent,c=_objectSpread({},n,{right:n.left+n.width,bottom:n.top+n.height}),l=h.params||{},d=_objectSpread({},h.directions),m=l.allowedDirections||{left:!0,right:!0,bottom:!0,top:!0};Object.keys(m).forEach(function(e){m[e]||(d[e]=0)});var p=getCurrentWidth(c,d,s),g=getCurrentHeight(c,d,s);d=fitConditions(d,c,a,s,o),p=getCurrentWidth(c,d,s),g=getCurrentHeight(c,d,s);// Checks ratio:
var u=null;if(l.preserveAspectRatio?u=c.width/c.height:r.minimum&&p/g<r.minimum?u=r.minimum:r.maximum&&p/g>r.maximum&&(u=r.maximum),u){var f=l.respectDirection;if(f||(c.width>c.height?f="width":f="height"),"width"===f){var v=c.height-p/u;m.top&&m.bottom?(d.bottom=-v/(2*s),d.top=-v/(2*s)):m.top?d.top=-v/s:m.bottom?d.bottom=-v/s:m.right?d.right=0:m.left&&(d.left=0)}else if("height"===f){var w=c.width-g*u;m.left&&m.right?(d.left=-w/(2*s),d.right=-w/(2*s)):m.left?d.left=-w/s:m.right?d.right=-w/s:m.top?d.top=0:m.bottom&&(d.bottom=0)}else ALL_DIRECTIONS.forEach(function(e){d[e]*=0})}// 3. Third step: check if desired box with correct aspect ratios break some limits and fit to this conditions
return d=fitConditions(d,c,a,s,o,u),{width:n.width+s*(i(d.right)+i(d.left)),height:n.height+s*(i(d.top)+i(d.bottom)),left:t(0,n.left-s*i(d.left)),top:t(0,n.top-s*i(d.top))}}function move(e){var t=Math.max,i=e.coordinates,n=e.imageSize,a=e.coefficient,o=e.moveEvent,s=_objectSpread({},o.directions),r={left:i.left+a*s.left,top:i.top+a*s.top,width:i.width,height:i.height};return 0>r.left&&(r.left=0),r.left+r.width>n.width&&(r.left=t(0,n.width-r.width)),0>r.top&&(r.top=0),r.top+r.height>n.height&&(r.top=t(0,n.height-r.height)),r}// eslint-disable-next-line no-unused-vars
function areaSize(e){var t=e.cropper,i=e.image,n=e.imageWidth,a=e.imageHeight,o=t.clientHeight,s=t.clientWidth,r=o,h=n*o/a;return h>s&&(h=s,r=a*s/n),{width:h,height:r}}// eslint-disable-next-line no-unused-vars
function defaultPosition(e){var t=e.cropper,i=e.image,n=e.stencilWidth,a=e.stencilHeight,o=e.imageWidth,s=e.imageHeight,r=e.props;return{left:o/2-n/2,top:s/2-a/2}}// eslint-disable-next-line no-unused-vars
function defaultSize(e){var i,n,t=Math.max,a=e.cropper,o=e.image,s=e.minWidth,r=e.minHeight,h=e.maxWidth,c=e.maxHeight,l=e.imageWidth,d=e.imageHeight,m=e.props;return c>h?(i=t(r,.8*c),n=t(s,.8*h)):(n=t(s,.8*h),i=t(r,.8*c)),{height:i,width:n}}function percentRestrictions(e){var t=e.minWidth,i=e.minHeight,n=e.maxWidth,a=e.maxHeight,o=e.imageWidth,s=e.imageHeight;return{minWidth:t/100*o,minHeight:i/100*s,maxWidth:n?n/100*o:o,maxHeight:a?a/100*s:s}}var cn$9=easyBem("vue-advanced-cropper");function migrateAlgorithm(e,t,i){function n(n){return console.warn("The arguments will be passed to the prop '".concat(t,"' as an single object {").concat(Object.keys(n).join(","),"} in the future releases. You should change the interface of your function.")),e.apply(void 0,_toConsumableArray(i(n)))}return function(t){if(1<e.length)return n(t);try{return e(t)}catch(i){return n(t)}}}var script$a={name:"Cropper",props:{src:{type:String,default:null},resizeAlgorithm:{type:Function,default:resize},moveAlgorithm:{type:Function,default:move},defaultSize:{type:Function,default:defaultSize},defaultPosition:{type:Function,default:defaultPosition},areaSize:{type:Function,default:areaSize},restrictions:{type:Function,default:percentRestrictions},minWidth:{type:[Number,String],default:10},minHeight:{type:[Number,String],default:10},maxWidth:{type:[Number,String]},maxHeight:{type:[Number,String]},stencilComponent:{type:[Object,String],default:function(){return RectangleStencil}},stencilProps:{type:Object,default:function(){return{}}},classname:{type:String},imageClassname:{type:String},areaClassname:{type:String},backgroundClassname:{type:String},debounce:{type:Number,default:500},canvas:{type:Boolean,default:!0},checkCrossOrigin:{type:Boolean,default:!0},checkOrientation:{type:Boolean,default:!0},transitionTime:{type:Number,default:300}},data:function(){return{boundarySize:{width:null,height:null},imageLoaded:!1,imageAttributes:{crossOrigin:!1,src:null},imageTransforms:{rotate:null,scaleX:null,scaleY:null},imageSize:{width:null,height:null},coordinates:{left:0,top:0,width:0,height:0},frozenDirections:{width:!1,height:!1}}},computed:{coefficient:function(){return this.imageSize.width?this.imageSize.width/this.boundarySize.width:0},classes:function(){return{cropper:classnames(cn$9(),this.classname),image:classnames(cn$9("image"),this.imageClassname),area:classnames(cn$9("area"),this.areaClassname),stretcher:classnames(cn$9("stretcher")),background:classnames(cn$9("background"),this.backgroundClassname)}},stencilCoordinates:function(){var e=this.coordinates,t=e.width,i=e.height,n=e.left,a=e.top;return{width:t/this.coefficient,height:i/this.coefficient,left:n/this.coefficient,top:a/this.coefficient}},wrapperStyle:function(){return{width:"".concat(this.stencilCoordinates.width,"px"),height:"".concat(this.stencilCoordinates.height,"px"),left:"".concat(this.stencilCoordinates.left,"px"),top:"".concat(this.stencilCoordinates.top,"px")}},areaStyle:function(){return{width:this.boundarySize.width?"".concat(this.boundarySize.width,"px"):"auto",height:this.boundarySize.height?"".concat(this.boundarySize.height,"px"):"auto",opacity:this.imageLoaded?1:0,transition:"opacity ".concat(this.transitionTime,"ms")}},imageStyle:function(){var e={left:"50%",top:"50%",transform:"translate(-50%, -50%)"+getStyleTransforms(this.imageTransforms)},t=this.imageTransforms.flipped;return t?(e.width="".concat(this.boundarySize.height,"px"),e.height="".concat(this.boundarySize.width,"px")):(e.width="".concat(this.boundarySize.width,"px"),e.height="".concat(this.boundarySize.height,"px")),e},stencilRestrictions:function(){var e=migrateAlgorithm(this.restrictions,"restrictions",function(e){return[e.minWidth,e.minHeight,e.maxWidth,e.maxHeight,e.imageWidth,e.imageHeight]})({minWidth:+this.minWidth,minHeight:+this.minHeight,maxWidth:+this.maxWidth,maxHeight:+this.maxHeight,imageWidth:this.imageSize.width,imageHeight:this.imageSize.height,props:this.$props});return this.minWidth>this.imageSize.width&&(console.warn("Warning: minimum width (".concat(e.minWidth,"px) greater that the image width (").concat(this.imageSize.width,"px). It is set equal to the image width and width resizing was blocked")),e.minWidth=this.imageSize.width,e.widthFrozen=!0),this.minHeight>this.imageSize.height&&(console.warn("Warning: minimum height (".concat(e.minHeight,"px) greater that the image height (").concat(this.imageSize.height,"px). It is set equal to the image height and height resizing was blocked")),e.minHeight=this.imageSize.height,e.heightFrozen=!0),e.minWidth>e.maxWidth&&(console.warn("Warning: maximum width (".concat(e.maxWidth,"px) fewer that the minimum width (").concat(e.minWidth,"px). It is set equal to the minimum width and width resizing was blocked")),e.maxWidth=e.minWidth,e.widthFrozen=!0),e.minHeight>e.maxHeight&&(console.warn("Warning: maximum height (".concat(e.maxHeight,"px) fewer that the minimum height (").concat(e.minHeight,"px). It is set equal to the minimum height and height resizing was blocked")),e.maxHeight=e.minHeight,e.heightFrozen=!0),(!e.maxWidth||e.maxWidth>this.imageSize.width)&&(e.maxWidth=this.imageSize.width),(!e.maxHeight||e.maxHeight>this.imageSize.height)&&(e.maxHeight=this.imageSize.height),e}},watch:{src:function(){this.onChangeImage()},minWidth:function(){this.resetCoordinates()},maxWidth:function(){this.resetCoordinates()},minHeight:function(){this.resetCoordinates()},maxHeight:function(){this.resetCoordinates()}},mounted:function(){var e=this;this.debouncedUpdate=debounce_1(this.update,this.debounce),window.addEventListener("resize",this.refreshImage),window.addEventListener("orientationchange",this.refreshImage),this.$refs.image.addEventListener("load",function(){e.$refs.image&&e.refreshImage().then(e.resetCoordinates)}),this.onChangeImage()},destroyed:function(){window.removeEventListener("resize",this.refreshImage),window.removeEventListener("orientationchange",this.refreshImage)},methods:{// External methods
getResult:function(){return this.canvas&&this.src?(this.updateCanvas(this.coordinates),{coordinates:_objectSpread({},this.coordinates),canvas:this.$refs.canvas}):{coordinates:_objectSpread({},this.coordinates)}},// Internal methods
getArea:function(){return this.$refs.area},getStencil:function(){return this.$refs.stencil},updateCanvas:function(e){// This function can be asynchronously called because it's debounced
// Therefore there is workaround to prevent processing after the component was unmounted
if(this.$refs.canvas){var t=this.$refs.image,i=this.checkOrientation?prepareSource(this.$refs.sourceCanvas,t,this.imageTransforms):t,n=this.$refs.canvas;n.width=e.width,n.height=e.height;var a=n.getContext("2d");a.drawImage(i,e.left,e.top,e.width,e.height,0,0,e.width,e.height)}},update:function(){this.$emit("change",this.getResult())},onChangeCoordinates:function(e){var t=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1];this.coordinates=e,this.$listeners&&this.$listeners.change&&(t?this.debouncedUpdate():this.update())},onChangeImage:function(){var e=this;if(this.imageLoaded=!1,this.delayedTransforms=null,this.src){var t=isCrossOriginURL(this.src);t&&this.canvas&&this.checkCrossOrigin&&(this.imageAttributes.crossOrigin="anonymous"),setTimeout(function(){e.checkOrientation?parseImage(t?addTimestamp(e.src):e.src).then(e.onParseImage):e.onParseImage({})},this.transitionTime)}else this.clearImage()},onParseImage:function(e){var t=this,i=e.arrayBuffer,n=e.orientation;this.imageAttributes.src=i&&n&&isLocal(this.src)?arrayBufferToDataURL(i):this.src,this.imageTransforms=getImageTransforms(n),Vue.nextTick(function(){var e=t.$refs.image;e&&e.complete&&t.refreshImage().then(t.resetCoordinates)})},onResize:function(e){this.frozenDirections.width&&(e.directions.left=0,e.directions.right=0),this.frozenDirections.height&&(e.directions.top=0,e.directions.bottom=0),this.onChangeCoordinates(this.resizeAlgorithm({coordinates:this.coordinates,restrictions:this.stencilRestrictions,imageSize:this.imageSize,coefficient:this.coefficient,aspectRatio:this.stencilAspectRatios(),resizeEvent:e}))},onMove:function(e){this.onChangeCoordinates(this.moveAlgorithm({coordinates:this.coordinates,imageSize:this.imageSize,coefficient:this.coefficient,moveEvent:e}))},defaultCoordinates:function(){var e=Math.max,t=Math.min,i=this.stencilAspectRatios(),n=this.stencilRestrictions,a=n.minWidth,o=n.minHeight,s=n.maxWidth,r=n.maxHeight,h=this.imageSize,c={};if(!i.minimum&&!i.maximum)c.height=o,c.width=a;else{var l={width:{maximum:i.minimum?t(r,a/i.minimum):r,minimum:i.maximum?e(o,a/i.maximum):o},height:{maximum:i.maximum?t(s,o*i.maximum):s,minimum:i.mininum?e(a,o*i.mininum):a}};if(l.width.maximum>=l.width.minimum)c.width=a,c.height=l.width.minimum;else if(l.height.maximum>=l.height.minimum)c.height=o,c.width=l.height.minimum;else throw"Error: current aspect ratio is incompatible with minimum/maximum height and width settings. Can't setup default coordinates"}return c.left=h.width/2-c.width/2,c.top=h.height/2-c.height/2,c},setCoordinates:function(e){var t=this;Vue.nextTick(function(){return t.imageLoaded?void t.applyTransforms(e):void(t.delayedTransforms=e)})},applyTransforms:function(e){var t=this,i=this.imageSize,n=this.coefficient,a=this.stencilAspectRatios(),o=function(e,a){return t.moveAlgorithm({coordinates:e,imageSize:i,coefficient:n,moveEvent:new MoveEvent(null,{left:(a.left-e.left)/n,top:(a.top-e.top)/n})})},s=function(e,s){var r=t.defaultCoordinates();return r=t.resizeAlgorithm({coordinates:r,restrictions:t.stencilRestrictions,imageSize:i,coefficient:n,aspectRatio:a,resizeEvent:new ResizeEvent(null,{left:(s.width-r.width)/(2*n),right:(s.width-r.width)/(2*n),top:(s.height-r.height)/(2*n),bottom:(s.height-r.height)/(2*n)})}),o(r,{left:e.left,top:e.top})},r=this.coordinates;return e.forEach||(e=[e]),e.forEach(function(e){var i={};i="function"==typeof e?e(_objectSpread({},r),t.imageSize):e,isUndefined(i.width)&&isUndefined(i.height)||(r=s(r,_objectSpread({},r,i))),isUndefined(i.left)&&isUndefined(i.top)||(r=o(r,_objectSpread({},r,i)))}),this.onChangeCoordinates(r,!1),r},resetCoordinates:function(){var e=this;// This function can be asynchronously called after completion of refreshing image promise
// Therefore there is a workaround to prevent processing after the component was unmounted
if(this.$refs.image){var t=this.$refs.cropper,i=this.$refs.image,n=this.stencilRestrictions,a=n.minWidth,o=n.minHeight,s=n.maxWidth,r=n.maxHeight,h=n.widthFrozen,c=n.heightFrozen;this.frozenDirections.width=!!h,this.frozenDirections.height=!!c;var l=migrateAlgorithm(this.defaultSize,"defaultSize",function(e){return[e.cropper,e.image,{minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight},e.imageWidth,e.imageHeight,e.props]})(_objectSpread({cropper:t,image:i,imageWidth:this.imageSize.width,imageHeight:this.imageSize.height,props:this.$props},this.stencilRestrictions));(l.width<a||l.height<o||l.width>s||l.height>r)&&console.warn("Warning: default size breaking size restrictions. Check your defaultSize function");var d=[l,function(n){return _objectSpread({},migrateAlgorithm(e.defaultPosition,"defaultPosition",function(e){return[e.cropper,e.image,e.stencilWidth,e.stencilHeight,e.imageWidth,e.imageHeight,e.props]})({cropper:t,image:i,stencilWidth:n.width,stencilHeight:n.height,imageWidth:e.imageSize.width,imageHeight:e.imageSize.height,props:e.$props}))}];this.delayedTransforms&&d.push.apply(d,_toConsumableArray(Array.isArray(this.delayedTransforms)?this.delayedTransforms:[this.delayedTransforms])),this.applyTransforms(d),this.delayedTransforms=null,this.imageLoaded=!0}},clearImage:function(){var e=this.$refs.stretcher;this.imageLoaded=!1,this.onChangeCoordinates({left:0,top:0,width:0,height:0},!1),setTimeout(function(){e.style.height="auto",e.style.width="auto"},this.transitionTime)},refreshImage:function(){var e=this;if(this.src){var t=this.$refs.image,i=this.$refs.stretcher;this.imageTransforms.flipped?(this.imageSize.height=t.naturalWidth,this.imageSize.width=t.naturalHeight):(this.imageSize.height=t.naturalHeight,this.imageSize.width=t.naturalWidth);var n=this.imageSize.width/this.imageSize.height;return this.imageSize.height>this.imageSize.width?(i.style.height="".concat(this.imageSize.height,"px"),i.style.width="".concat(i.clientHeight*n,"px"),i.clientWidth/i.clientHeight!=n&&(i.style.height="".concat(i.clientWidth/n,"px"))):(i.style.width="".concat(this.imageSize.width,"px"),i.style.height="".concat(i.clientWidth/n,"px"),i.clientHeight/i.clientWidth!=n&&(i.style.width="".concat(i.clientHeight*n,"px"))),new Promise(function(t){var i=e.$refs.cropper,n=e.$refs.image;Vue.nextTick(function(){var a=migrateAlgorithm(e.areaSize,"areaSize",function(e){return[e.cropper,e.image,e.imageWidth,e.imageHeight]})({cropper:i,image:n,imageWidth:e.imageSize.width,imageHeight:e.imageSize.height}),o=a.height,s=a.width;o&&(e.boundarySize.height=o),s&&(e.boundarySize.width=s),t()})})}},stencilAspectRatios:function(){return this.$refs.stencil.aspectRatios?this.$refs.stencil.aspectRatios():{minimum:this.stencilProps.aspectRatio||this.stencilProps.minAspectRatio,maximum:this.stencilProps.aspectRatio||this.stencilProps.maxAspectRatio}}}},__vue_script__$a=script$a,__vue_render__$a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"cropper",class:e.classes.cropper},[i("div",{class:e.classes.background,style:e.areaStyle}),e._v(" "),i("div",{ref:"stretcher",class:e.classes.stretcher}),e._v(" "),i("div",{ref:"area",class:e.classes.area,style:e.areaStyle},[i("img",{ref:"image",class:e.classes.image,style:e.imageStyle,attrs:{crossOrigin:e.imageAttributes.crossOrigin,src:e.imageAttributes.src}}),e._v(" "),i(e.stencilComponent,e._b({ref:"stencil",tag:"component",attrs:{img:{src:e.imageAttributes.src,size:e.imageSize,transforms:e.imageTransforms},"result-coordinates":e.coordinates,"stencil-coordinates":e.stencilCoordinates},on:{resize:e.onResize,move:e.onMove}},"component",e.stencilProps,!1)),e._v(" "),e.canvas?i("canvas",{ref:"canvas",style:{display:"none"}}):e._e(),e._v(" "),e.canvas?i("canvas",{ref:"sourceCanvas",style:{display:"none"}}):e._e()],1)])},__vue_staticRenderFns__$a=[];/* script */__vue_render__$a._withStripped=!0;/* style */var __vue_inject_styles__$a=void 0,__vue_scope_id__$a=void 0,__vue_module_identifier__$a=void 0,__vue_is_functional_template__$a=!1,Cropper=normalizeComponent_1({render:__vue_render__$a,staticRenderFns:__vue_staticRenderFns__$a},void 0,__vue_script__$a,__vue_scope_id__$a,__vue_is_functional_template__$a,__vue_module_identifier__$a,void 0,void 0),cn$a=easyBem("vue-preview-image"),script$b={name:"PreviewImage",props:{img:{type:String},classname:{type:String},imageClassname:{type:String},width:{type:Number},height:{type:Number},top:{type:Number},left:{type:Number},previewWidth:{type:Number,required:!0},previewHeight:{type:Number,required:!0}},data:function(){return{imageSize:{width:0,height:0}}},computed:{classnames:function(){return{default:classnames(cn$a(),this.classname),image:classnames(cn$a("image"),this.imageClassname)}},wrapperStyle:function(){return{width:"".concat(this.previewWidth,"px"),height:"".concat(this.previewHeight,"px")}},imageStyle:function(){var e=this.previewHeight/this.height,t=this.imageSize.height*e,i=this.imageSize.width*e;return{width:"".concat(i,"px"),height:"".concat(t,"px"),left:"".concat(-this.left*e,"px"),top:"".concat(-this.top*e,"px")}}},watch:{img:function(){this.onChangeImage()}},mounted:function(){this.onChangeImage()},methods:{refreshImage:function(){var e=this.$refs.image;this.imageSize.height=e.naturalHeight,this.imageSize.width=e.naturalWidth},onChangeImage:function(){var e=this,t=this.$refs.image;t.complete?this.refreshImage():t.addEventListener("load",function(){e.refreshImage()})}}},__vue_script__$b=script$b,__vue_render__$b=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.classnames.default,style:e.wrapperStyle},[i("img",{ref:"image",class:e.classnames.image,style:e.imageStyle,attrs:{src:e.img}})])},__vue_staticRenderFns__$b=[];/* scoped */__vue_render__$b._withStripped=!0;/* style */var __vue_inject_styles__$b=void 0,__vue_scope_id__$b=void 0,__vue_module_identifier__$b=void 0,__vue_is_functional_template__$b=!1,PreviewImage=normalizeComponent_1({render:__vue_render__$b,staticRenderFns:__vue_staticRenderFns__$b},void 0,__vue_script__$b,__vue_scope_id__$b,__vue_is_functional_template__$b,__vue_module_identifier__$b,void 0,void 0);/* scoped */Vue.component("cropper",Cropper),Vue.component("rectangle-stencil",RectangleStencil),Vue.component("circle-stencil",CircleStencil),Vue.component("simple-handler",SimpleHandler),Vue.component("simple-line",SimpleLine);export{BoundingBox,CircleStencil,Cropper,DragEvent,DraggableArea,DraggableElement,HandlerWrapper,LineWrapper,MoveEvent,PreviewImage,PreviewResult,RectangleStencil,ResizeEvent,SimpleHandler,SimpleLine};

function styleInject(id, css) {
	if (!css || typeof document === 'undefined') { return; }

	var element;
	var head = document.head || document.getElementsByTagName('head')[0];
	var styleElements  = head.getElementsByTagName('style');

	// To prevent dublicate of the style code during the script reload
	for (var i = 0; i < styleElements.length; i++) {
		if (styleElements[i] && styleElements[i].innerText && styleElements[i].innerText.startsWith('/*for=' + id)) {
			element = styleElements[i];
		}
	}

	if (!element) {
		element = document.createElement('style');
		element.type = 'text/css';
		head.insertBefore(element, styleElements[0] || head.firstChild);
	}

	if (element.styleSheet) {
		element.styleSheet.cssText = css;
	} else {
		var text = document.createTextNode('/*for=' + id + '*/' + css);
		element.innerHTML = "";
		element.appendChild(text);
	}
};
styleInject("vue-advanced-cropper", ".vue-advanced-cropper {  text-align: center;  position: relative;  overflow: hidden;  -webkit-user-select: none;     -moz-user-select: none;      -ms-user-select: none;          user-select: none;  max-height: 100%;  max-width: 100%;}.vue-advanced-cropper__stretcher {  pointer-events: none;  position: relative;  max-width: 100%;  max-height: 100%;}.vue-advanced-cropper__image {  opacity: 0.5;  -webkit-user-select: none;     -moz-user-select: none;      -ms-user-select: none;          user-select: none;  position: absolute;  -webkit-transform-origin: center;          transform-origin: center;  max-width: unset !important;}.vue-advanced-cropper__area {  position: absolute;  left: 50%;  -webkit-transform: translate(-50%, -50%);          transform: translate(-50%, -50%);  top: 50%;}.vue-advanced-cropper__background {  position: absolute;  background: black;  top: 50%;  left: 50%;  -webkit-transform: translate(-50%, -50%);          transform: translate(-50%, -50%);}.vue-advanced-cropper__stencil-wrapper {  position: absolute;}/*# sourceMappingURL=Cropper.vue.map */.vue-square-handler {  display: block;  background: white;  height: 10px;  width: 10px;}/*# sourceMappingURL=SimpleHandler.vue.map */.vue-handler-wrapper {  position: absolute;  -webkit-transform: translate(-50%, -50%);          transform: translate(-50%, -50%);}.vue-handler-wrapper__draggable {  width: 30px;  height: 30px;  display: -webkit-box;  display: -ms-flexbox;  display: flex;  -webkit-box-align: center;      -ms-flex-align: center;          align-items: center;  -webkit-box-pack: center;      -ms-flex-pack: center;          justify-content: center;}.vue-handler-wrapper--west-north {  left: 0;  top: 0;  cursor: nw-resize;}.vue-handler-wrapper--north {  left: 50%;  top: 0;  cursor: n-resize;}.vue-handler-wrapper--east-north {  left: 100%;  top: 0;  cursor: ne-resize;}.vue-handler-wrapper--east {  left: 100%;  top: 50%;  cursor: e-resize;}.vue-handler-wrapper--east-south {  left: 100%;  top: 100%;  cursor: se-resize;}.vue-handler-wrapper--south {  left: 50%;  top: 100%;  cursor: s-resize;}.vue-handler-wrapper--west-south {  left: 0;  top: 100%;  cursor: sw-resize;}.vue-handler-wrapper--west {  left: 0;  top: 50%;  cursor: w-resize;}/*# sourceMappingURL=HandlerWrapper.vue.map */.vue-line-wrapper {  background: none;  position: absolute;  display: -webkit-box;  display: -ms-flexbox;  display: flex;  -webkit-box-align: center;      -ms-flex-align: center;          align-items: center;  -webkit-box-pack: center;      -ms-flex-pack: center;          justify-content: center;}.vue-line-wrapper--north, .vue-line-wrapper--south {  height: 12px;  width: 100%;  left: 0;  -webkit-transform: translateY(-50%);          transform: translateY(-50%);}.vue-line-wrapper--north {  top: 0;  cursor: n-resize;}.vue-line-wrapper--south {  top: 100%;  cursor: s-resize;}.vue-line-wrapper--east, .vue-line-wrapper--west {  width: 12px;  height: 100%;  -webkit-transform: translateX(-50%);          transform: translateX(-50%);  top: 0;}.vue-line-wrapper--east {  left: 100%;  cursor: e-resize;}.vue-line-wrapper--west {  left: 0;  cursor: w-resize;}/*# sourceMappingURL=LineWrapper.vue.map */.vue-bounding-box {  position: relative;  height: 100%;  width: 100%;}.vue-bounding-box__line {  position: absolute;}.vue-bounding-box__line--north {  top: 0;  width: 100%;  cursor: n-resize;}.vue-bounding-box__line--east {  left: 100%;  top: 0;  height: 100%;  cursor: e-resize;}.vue-bounding-box__line--south {  top: 100%;  width: 100%;  cursor: s-resize;}.vue-bounding-box__line--west {  left: 0;  top: 0;  height: 100%;  cursor: w-resize;}/*# sourceMappingURL=BoundingBox.vue.map */.vue-draggable-area {  position: relative;}/*# sourceMappingURL=DraggableArea.vue.map */.vue-preview-result {  overflow: hidden;  -webkit-box-sizing: border-box;          box-sizing: border-box;  position: absolute;  height: 100%;  width: 100%;}.vue-preview-result__wrapper {  position: absolute;}.vue-preview-result__image {  pointer-events: none;  position: absolute;  -webkit-user-select: none;     -moz-user-select: none;      -ms-user-select: none;          user-select: none;  -webkit-transform-origin: center;          transform-origin: center;  max-width: unset !important;}/*# sourceMappingURL=PreviewResult.vue.map */.vue-preview-image {  overflow: hidden;  position: relative;}.vue-preview-image__image {  pointer-events: none;  position: absolute;  max-width: unset !important;}/*# sourceMappingURL=PreviewImage.vue.map */.vue-simple-line {  background: none;  -webkit-transition: border 0.5s;  transition: border 0.5s;  border-color: rgba(255, 255, 255, 0.3);  border-width: 0;  border-style: solid;}.vue-simple-line--south, .vue-simple-line--north {  height: 0;  width: 100%;}.vue-simple-line--east, .vue-simple-line--west {  height: 100%;  width: 0;}.vue-simple-line--east {  border-right-width: 1px;}.vue-simple-line--west {  border-left-width: 1px;}.vue-simple-line--south {  border-top-width: 1px;}.vue-simple-line--north {  border-bottom-width: 1px;}.vue-simple-line--hover {  opacity: 1;  border-color: white;}/*# sourceMappingURL=SimpleLine.vue.map */.vue-circle-stencil {  position: absolute;  height: 100%;  width: 100%;  -webkit-box-sizing: content-box;          box-sizing: content-box;  cursor: move;}.vue-circle-stencil__preview {  border-radius: 50%;}/*# sourceMappingURL=CircleStencil.vue.map */.vue-rectangle-stencil {  position: absolute;  height: 100%;  width: 100%;  -webkit-box-sizing: border-box;          box-sizing: border-box;  cursor: move;}/*# sourceMappingURL=RectangleStencil.vue.map */");//# sourceMappingURL=index.es.js.map
